<!DOCTYPE html>
<html>
  <head>
    <title>SPUC</title>
    <link rel="stylesheet" type="text/css" href="/css/SPUC/main.css" title="Default">
    <script src='/js/SPUC/main.js'></script>
  </head>
  
  <body class="col">
    <header class="row">

      <a href="?path=/read&sort=recent" class="splash col">
        <p>Scarf Poutine You Clone</p>
        <p>Collaborative Comics</p>
      </a>
      
      : if $user {
      <aside class="column">
        <p><: $user.get('display_name') :></p>
        
        : my $ava = $user.get('avatar')
        <a href="?path=/profile">
          : if $ava {
          <img src="<:$ava.size(150,150):>">
        : } else {
          my profile
        : }
        </a>
      </aside>
      
      : } else if $path != '/register' {
      <aside class="column">
      <form method="POST" action="?path=/login" class="col" id="loginblock">
        : if $err {
        <span id="err"><:$err:></span>
        <a href="?path=/recover_request">recover password</a>
        : } 
        <input type="text" name="un" placeholder="user">
        <input type="password" name="pw" placeholder="password">
        <button type="submit">Log In</button>
        <a id="reglink" href="?path=/register">sign up</a>
      </form>
      </aside>
      : }
      
      
    </header>
    <nav class="row">
      : my $comics = $app.get( 'finished_comics' )      
      : if $comics.size() > 0 {
      <a href="?path=/read&sort=recent">read comics</a>
      : }
      : if $user {
      <a href="?path=/play">play</a>
      <a href="?path=/start">start a comic</a>
      <a href="?path=/mine&sort=recent">my comics</a>
      <a href="?path=/profile">my profile</a>
      <a href="?path=/logout">log out</a>
      : }
    </nav>

    : if $msg {
    <div class="message"><p><:$msg:></p></div>
    : }

    <main>
      
      : if $path == '/register' && ! $user {
        : include "register.tx"
      : } else if $path == '/profile' && $user {
        : include "profile.tx"
      : } else if( $path == '/play' && $user ) {
        : include "play.tx"
      : } else if $path == '/start' && $user && ( $params.action != 'start-comic' || $err ) {
        : include "start.tx"
      : } else if $path == '/recover_request' {
        : include "recover_request.tx"
      : } else if $path == '/recover' {
        : if $user {
          : include "update_password.tx" { nooriginal => 1 }
        : } else {
          <div class="err bigerr">reset link is stale</div>
        : }
      : } else if $path == '/mine' && $user {
        : include "read.tx" 
      : } else if $comics.size() > 10 {
        : include "read.tx"
      : } else {
        : include "about.tx"
      : }
      
      
    </main>

    : if $user && $user.get__is_admin {
    <hr>
    <footer class="message" style="margin-top:100px">
      Min Viable Product
      TODOS
      <ul>
        <li>link and page for email reset password</li>
        <li>email reset password</li>
        <li>correct level of mail check in production</li>
        <li>locking comics and other objects</li>
        <li>show artist</li>
        <li>contact info</li>
      </ul>
      Other TODOS
      <ul>
        <li>email for account verification</li>
        <li>in progress comics</li>
        <li>bookmarks for comics</li>

        <li>modperl</li>
        
        <li>make sure only one user is playing a comic</li>

        <li>testing comic</li>
        <li>UI advice</li>
        
        <li>comic comments</li>
        <li>kudos</li>

        <li>group chat</li>
        
        <li>permissions/group datastore. Maybe a spuc admin group?</li>
        
        <li>spuc_admin.pl actions</li>
        <li>log view for admin</li>
        <li>logging for all things done</li>
        
        <li>porting comics and users</li>
        
        <li>RPC</li>
        <li>yote js -> server</li>
      </ul>
    </footer>
    : }
  </body>
</html>
